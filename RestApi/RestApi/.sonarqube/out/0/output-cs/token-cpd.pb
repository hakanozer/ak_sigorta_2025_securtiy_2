Š
S/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/Startup.cs
public 
class 
Startup 
{ 
public		 

void		 
ConfigureServices		 !
(		! "
IServiceCollection		" 4
services		5 =
)		= >
{

 
var 
key 
= 
Encoding 
. 
ASCII  
.  !
GetBytes! )
() *
$str* j
)j k
;k l
services 
. 
AddAuthentication "
(" #
x# $
=>% '
{ 	
x 
. %
DefaultAuthenticateScheme '
=( )
JwtBearerDefaults* ;
.; < 
AuthenticationScheme< P
;P Q
x 
. "
DefaultChallengeScheme $
=% &
JwtBearerDefaults' 8
.8 9 
AuthenticationScheme9 M
;M N
} 	
)	 

. 	
AddJwtBearer	 
( 
x 
=> 
{ 	
x 
.  
RequireHttpsMetadata "
=# $
false% *
;* +
x 
. 
	SaveToken 
= 
true 
; 
x 
. %
TokenValidationParameters '
=( )
new* -%
TokenValidationParameters. G
{ $
ValidateIssuerSigningKey (
=) *
true+ /
,/ 0
IssuerSigningKey  
=! "
new# & 
SymmetricSecurityKey' ;
(; <
key< ?
)? @
,@ A
ValidateIssuer 
=  
false! &
,& '
ValidateAudience  
=! "
false# (
} 
; 
} 	
)	 

;
 
services 
. 
AddMvc 
( 
) 
; 
} 
public   

void   
	Configure   
(   
IApplicationBuilder   -
app  . 1
,  1 2
IWebHostEnvironment  3 F
env  G J
)  J K
{!! 
if"" 

("" 
env"" 
."" 
IsDevelopment"" 
("" 
)"" 
)""  
{## 	
app$$ 
.$$ %
UseDeveloperExceptionPage$$ )
($$) *
)$$* +
;$$+ ,
}%% 	
else&& 
{'' 	
app(( 
.(( 
UseHsts(( 
((( 
)(( 
;(( 
})) 	
app++ 
.++ 
UseHttpsRedirection++ 
(++  
)++  !
;++! "
app,, 
.,, 
UseAuthentication,, 
(,, 
),, 
;,,  
app-- 
.-- 
UseMvc-- 
(-- 
)-- 
;-- 
}.. 
}// ñ@
d/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/Services/PasswordManager.cs
public 
class 
PasswordManager 
{ 
private 
readonly 
byte 
[ 
] 
_key  
;  !
private		 
readonly		 
byte		 
[		 
]		 
_iv		 
;		  
string

 


_secretKey

 
=

 
$str

 F
;

F G
public 

PasswordManager 
( 
) 
{ 
using 
( 
var 
deriveBytes 
=  
new! $
Rfc2898DeriveBytes% 7
(7 8

_secretKey 
, 
new 
byte 
[ 
] 
{ 
$num 
, 
$num #
,# $
$num% )
,) *
$num+ /
,/ 0
$num1 5
,5 6
$num7 ;
,; <
$num= A
,A B
$numC G
}H I
,I J
$num 
, 
HashAlgorithmName 
. 
SHA256 $
) 	
)	 

{ 	
_key 
= 
deriveBytes 
. 
GetBytes '
(' (
$num( *
)* +
;+ ,
_iv 
= 
deriveBytes 
. 
GetBytes &
(& '
$num' )
)) *
;* +
} 	
} 
public 

string 
Encrypt 
( 
string  
	plainText! *
)* +
{ 
if 

( 
string 
. 
IsNullOrEmpty  
(  !
	plainText! *
)* +
)+ ,
throw 
new !
ArgumentNullException +
(+ ,
nameof, 2
(2 3
	plainText3 <
)< =
)= >
;> ?
byte   
[   
]   
encryptedBytes   
;   
using"" 
("" 
var"" 
aesAlg"" 
="" 
Aes"" 
.""  
Create""  &
(""& '
)""' (
)""( )
{## 	
aesAlg$$ 
.$$ 
Key$$ 
=$$ 
_key$$ 
;$$ 
aesAlg'' 
.'' 

GenerateIV'' 
('' 
)'' 
;''  
byte(( 
[(( 
](( 
iv(( 
=(( 
aesAlg(( 
.(( 
IV(( !
;((! "
ICryptoTransform** 
	encryptor** &
=**' (
aesAlg**) /
.**/ 0
CreateEncryptor**0 ?
(**? @
aesAlg**@ F
.**F G
Key**G J
,**J K
iv**L N
)**N O
;**O P
using,, 
(,, 
var,, 
	msEncrypt,,  
=,,! "
new,,# &
MemoryStream,,' 3
(,,3 4
),,4 5
),,5 6
{-- 
	msEncrypt// 
.// 
Write// 
(//  
iv//  "
,//" #
$num//$ %
,//% &
iv//' )
.//) *
Length//* 0
)//0 1
;//1 2
using11 
(11 
var11 
	csEncrypt11 $
=11% &
new11' *
CryptoStream11+ 7
(117 8
	msEncrypt118 A
,11A B
	encryptor11C L
,11L M
CryptoStreamMode11N ^
.11^ _
Write11_ d
)11d e
)11e f
using22 
(22 
var22 
	swEncrypt22 $
=22% &
new22' *
StreamWriter22+ 7
(227 8
	csEncrypt228 A
)22A B
)22B C
{33 
	swEncrypt44 
.44 
Write44 #
(44# $
	plainText44$ -
)44- .
;44. /
}55 
encryptedBytes77 
=77  
	msEncrypt77! *
.77* +
ToArray77+ 2
(772 3
)773 4
;774 5
}88 
}99 	
return;; 
Convert;; 
.;; 
ToBase64String;; %
(;;% &
encryptedBytes;;& 4
);;4 5
;;;5 6
}<< 
public>> 

string>> 
Decrypt>> 
(>> 
string>>  

cipherText>>! +
)>>+ ,
{?? 
if@@ 

(@@ 
string@@ 
.@@ 
IsNullOrEmpty@@  
(@@  !

cipherText@@! +
)@@+ ,
)@@, -
throwAA 
newAA !
ArgumentNullExceptionAA +
(AA+ ,
nameofAA, 2
(AA2 3

cipherTextAA3 =
)AA= >
)AA> ?
;AA? @
byteCC 
[CC 
]CC 
cipherBytesCC 
=CC 
ConvertCC $
.CC$ %
FromBase64StringCC% 5
(CC5 6

cipherTextCC6 @
)CC@ A
;CCA B
usingEE 
(EE 
varEE 
aesAlgEE 
=EE 
AesEE 
.EE  
CreateEE  &
(EE& '
)EE' (
)EE( )
{FF 	
aesAlgGG 
.GG 
KeyGG 
=GG 
_keyGG 
;GG 
byteJJ 
[JJ 
]JJ 
ivJJ 
=JJ 
newJJ 
byteJJ  
[JJ  !
$numJJ! #
]JJ# $
;JJ$ %
ArrayKK 
.KK 
CopyKK 
(KK 
cipherBytesKK "
,KK" #
$numKK$ %
,KK% &
ivKK' )
,KK) *
$numKK+ ,
,KK, -
ivKK. 0
.KK0 1
LengthKK1 7
)KK7 8
;KK8 9
aesAlgLL 
.LL 
IVLL 
=LL 
ivLL 
;LL 
ICryptoTransformNN 
	decryptorNN &
=NN' (
aesAlgNN) /
.NN/ 0
CreateDecryptorNN0 ?
(NN? @
aesAlgNN@ F
.NNF G
KeyNNG J
,NNJ K
aesAlgNNL R
.NNR S
IVNNS U
)NNU V
;NNV W
usingPP 
(PP 
varPP 
	msDecryptPP  
=PP! "
newPP# &
MemoryStreamPP' 3
(PP3 4
cipherBytesPP4 ?
,PP? @
$numPPA C
,PPC D
cipherBytesPPE P
.PPP Q
LengthPPQ W
-PPX Y
$numPPZ \
)PP\ ]
)PP] ^
usingQQ 
(QQ 
varQQ 
	csDecryptQQ  
=QQ! "
newQQ# &
CryptoStreamQQ' 3
(QQ3 4
	msDecryptQQ4 =
,QQ= >
	decryptorQQ? H
,QQH I
CryptoStreamModeQQJ Z
.QQZ [
ReadQQ[ _
)QQ_ `
)QQ` a
usingRR 
(RR 
varRR 
	srDecryptRR  
=RR! "
newRR# &
StreamReaderRR' 3
(RR3 4
	csDecryptRR4 =
)RR= >
)RR> ?
{SS 
returnTT 
	srDecryptTT  
.TT  !
	ReadToEndTT! *
(TT* +
)TT+ ,
;TT, -
}UU 
}VV 	
}WW 
public[[ 

string[[ 
GenerateSecureKey[[ #
([[# $
int[[$ '
keySizeInBytes[[( 6
=[[7 8
$num[[9 ;
)[[; <
{\\ 
byte]] 
[]] 
]]] 
key]] 
=]] 
new]] 
byte]] 
[]] 
keySizeInBytes]] ,
]]], -
;]]- .
using^^ 
(^^ 
var^^ 
rng^^ 
=^^ !
RandomNumberGenerator^^ .
.^^. /
Create^^/ 5
(^^5 6
)^^6 7
)^^7 8
{__ 	
rng`` 
.`` 
GetBytes`` 
(`` 
key`` 
)`` 
;`` 
}aa 	
returnbb 
Convertbb 
.bb 
ToBase64Stringbb %
(bb% &
keybb& )
)bb) *
;bb* +
}cc 
}dd ×5
S/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddRateLimiter 
(  
options  '
=>( *
{ 
options 
. 
GlobalLimiter 
= "
PartitionedRateLimiter 2
.2 3
Create3 9
<9 :
HttpContext: E
,E F
stringG M
>M N
(N O
httpContextO Z
=>[ ]
RateLimitPartition 
. !
GetFixedWindowLimiter 0
(0 1
partitionKey 
: 
httpContext %
.% &
User& *
.* +
Identity+ 3
?3 4
.4 5
Name5 9
??: <
httpContext= H
.H I
RequestI P
.P Q
HeadersQ X
.X Y
HostY ]
.] ^
ToString^ f
(f g
)g h
,h i
factory 
: 
	partition 
=> !
new" %)
FixedWindowRateLimiterOptions& C
{ 
AutoReplenishment !
=" #
true$ (
,( )
PermitLimit 
= 
$num 
,  

QueueLimit 
= 
$num 
, 
Window 
= 
TimeSpan !
.! "
FromSeconds" -
(- .
$num. 0
)0 1
} 
) 
) 
; 
} 
) 
; 
builder 
. 
Services 
. 
AddDbContext 
<  
ApplicationDbContext 2
>2 3
(3 4
options4 ;
=>< >
options 
. 
	UseSqlite 
( 
builder 
. 
Configuration +
.+ ,
GetConnectionString, ?
(? @
$str@ S
)S T
)T U
)U V
;V W
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
var "
MyAllowSpecificOrigins 
= 
$str 7
;7 8
builder   
.   
Services   
.   
AddCors   
(   
options    
=>  ! #
{!! 
options"" 
."" 
	AddPolicy"" 
("" 
name"" 
:"" "
MyAllowSpecificOrigins"" 2
,""2 3
policy## 

=>## 
{$$ 
policy%% 
.%% 
WithOrigins%% 
(%% 
$str&& 
,&& 
$str'' 
,'' 
$str(( 
,(( 
$str))  
)** 	
.++ 	
AllowAnyHeader++	 
(++ 
)++ 
.,, 	
AllowAnyMethod,,	 
(,, 
),, 
.-- 	
AllowCredentials--	 
(-- 
)-- 
;-- 
}.. 
).. 
;.. 
}// 
)// 
;// 
var33 
key33 
=33 	
Encoding33
 
.33 
ASCII33 
.33 
GetBytes33 !
(33! "
builder33" )
.33) *
Configuration33* 7
.337 8
GetValue338 @
<33@ A
string33A G
>33G H
(33H I
$str33I R
)33R S
)33S T
;33T U
builder44 
.44 
Services44 
.44 
AddAuthentication44 "
(44" #
JwtBearerDefaults44# 4
.444 5 
AuthenticationScheme445 I
)44I J
.55 
AddJwtBearer55 
(55 
options55 
=>55 
{66 
options77 
.77  
RequireHttpsMetadata77 $
=77% &
false77' ,
;77, -
options88 
.88 
	SaveToken88 
=88 
true88  
;88  !
options99 
.99 %
TokenValidationParameters99 )
=99* +
new99, /%
TokenValidationParameters990 I
{:: 	$
ValidateIssuerSigningKey;; $
=;;% &
true;;' +
,;;+ ,
IssuerSigningKey<< 
=<< 
new<< " 
SymmetricSecurityKey<<# 7
(<<7 8
key<<8 ;
)<<; <
,<<< =
ValidateIssuer== 
=== 
false== "
,==" #
ValidateAudience>> 
=>> 
false>> $
}?? 	
;??	 

}@@ 
)@@ 
;@@ 
varBB 
appBB 
=BB 	
builderBB
 
.BB 
BuildBB 
(BB 
)BB 
;BB 
ifEE 
(EE 
!EE 
appEE 
.EE 	
EnvironmentEE	 
.EE 
IsDevelopmentEE "
(EE" #
)EE# $
)EE$ %
{FF 
appGG 
.GG 
UseHstsGG 
(GG 
)GG 
;GG 
appHH 
.HH 
UseHttpsRedirectionHH 
(HH 
)HH 
;HH 
}JJ 
ifQQ 
(QQ 
appQQ 
.QQ 
EnvironmentQQ 
.QQ 
IsDevelopmentQQ !
(QQ! "
)QQ" #
)QQ# $
{RR 
appSS 
.SS %
UseDeveloperExceptionPageSS !
(SS! "
)SS" #
;SS# $
}TT 
appVV 
.VV 
UseMiddlewareVV 
<VV "
ErrorHandlerMiddlewareVV (
>VV( )
(VV) *
)VV* +
;VV+ ,
appWW 
.WW 
UseMiddlewareWW 
<WW 
GlobalMiddlewareWW "
>WW" #
(WW# $
)WW$ %
;WW% &
appXX 
.XX 
UseRateLimiterXX 
(XX 
)XX 
;XX 
appYY 
.YY 
UseHttpsRedirectionYY 
(YY 
)YY 
;YY 
appZZ 
.ZZ 
UseAuthenticationZZ 
(ZZ 
)ZZ 
;ZZ 
app[[ 
.[[ 
UseAuthorization[[ 
([[ 
)[[ 
;[[ 
app]] 
.]] 
MapControllers]] 
(]] 
)]] 
;]] 
app__ 
.__ 
Run__ 
(__ 
)__ 	
;__	 
¥	
W/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/Models/User.cs
	namespace 	
RestApi
 
. 
Models 
{ 
public 

class 
User 
{ 
[ 	
Key	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public

 
string

 
Username

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
=

- .
string

/ 5
.

5 6
Empty

6 ;
;

; <
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Role 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} 
} Í
Z/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/Models/Product.cs
	namespace 	
RestApi
 
. 
Models 
{ 
public 

class 
Product 
{ 
[ 	
Key	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[

 	
Required

	 
]

 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
[ 	
Required	 
] 
public 
decimal 
Price 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} ‚

W/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/Models/Note.cs
	namespace 	
RestApi
 
. 
Models 
{ 
public 

class 
Note 
{ 
[ 	
Key	 
] 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
[ 	
Required	 
] 
public 
string 
Content 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
[ 	
Required	 
] 
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
[ 	

ForeignKey	 
( 
$str 
) 
] 
public 
User 
User 
{ 
get 
; 
set  #
;# $
}% &
=' (
null) -
!- .
;. /
} 
} ×
c/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/Models/dto/UserLoginDto.cs
	namespace 	
RestApi
 
. 
Models 
. 
Dto 
{ 
public 

class 
UserLoginDto 
{ 
[

 	
Required

	 
]

 
[ 	
StringLength	 
( 
maximumLength #
:# $
$num% (
,( )
MinimumLength* 7
=8 9
$num: ;
,; <
ErrorMessage= I
=J K
$strL {
){ |
]| }
[ 	
EmailAddress	 
( 
ErrorMessage "
=# $
$str% H
)H I
]I J
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
[ 	
Required	 
] 
[ 	
StringLength	 
( 
maximumLength #
:# $
$num% '
,' (
MinimumLength) 6
=7 8
$num9 :
,: ;
ErrorMessage< H
=I J
$strK y
)y z
]z {
[ 	
RegularExpression	 
( 
$str ,
,, -
ErrorMessage. :
=; <
$str= \
)\ ]
]] ^
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
[ 	
Required	 
] 
[ 	
	CityValid	 
( 
ErrorMessage 
=  !
$str" ^
)^ _
]_ `
public 
string 
City 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} 
} Ñ9
s/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/Migrations/20250311115221_InitialCreate.cs
	namespace 	
RestApi
 
. 

Migrations 
{ 
public 

partial 
class 
InitialCreate &
:' (
	Migration) 2
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str  
,  !
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 :
,: ;
nullable< D
:D E
falseF K
)K L
. 

Annotation #
(# $
$str$ :
,: ;
true< @
)@ A
,A B
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
nullable> F
:F G
falseH M
)M N
,N O
Price 
= 
table !
.! "
Column" (
<( )
decimal) 0
>0 1
(1 2
type2 6
:6 7
$str8 >
,> ?
nullable@ H
:H I
falseJ O
)O P
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 2
,2 3
x4 5
=>6 8
x9 :
.: ;
Id; =
)= >
;> ?
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 :
,: ;
nullable< D
:D E
falseF K
)K L
.   

Annotation   #
(  # $
$str  $ :
,  : ;
true  < @
)  @ A
,  A B
Username!! 
=!! 
table!! $
.!!$ %
Column!!% +
<!!+ ,
string!!, 2
>!!2 3
(!!3 4
type!!4 8
:!!8 9
$str!!: @
,!!@ A
nullable!!B J
:!!J K
false!!L Q
)!!Q R
,!!R S
Password"" 
="" 
table"" $
.""$ %
Column""% +
<""+ ,
string"", 2
>""2 3
(""3 4
type""4 8
:""8 9
$str"": @
,""@ A
nullable""B J
:""J K
false""L Q
)""Q R
,""R S
Role## 
=## 
table##  
.##  !
Column##! '
<##' (
string##( .
>##. /
(##/ 0
type##0 4
:##4 5
$str##6 <
,##< =
nullable##> F
:##F G
false##H M
)##M N
}$$ 
,$$ 
constraints%% 
:%% 
table%% "
=>%%# %
{&& 
table'' 
.'' 

PrimaryKey'' $
(''$ %
$str''% /
,''/ 0
x''1 2
=>''3 5
x''6 7
.''7 8
Id''8 :
)'': ;
;''; <
}(( 
)(( 
;(( 
migrationBuilder** 
.** 
CreateTable** (
(**( )
name++ 
:++ 
$str++ 
,++ 
columns,, 
:,, 
table,, 
=>,, !
new,," %
{-- 
Id.. 
=.. 
table.. 
... 
Column.. %
<..% &
int..& )
>..) *
(..* +
type..+ /
:../ 0
$str..1 :
,..: ;
nullable..< D
:..D E
false..F K
)..K L
.// 

Annotation// #
(//# $
$str//$ :
,//: ;
true//< @
)//@ A
,//A B
Content00 
=00 
table00 #
.00# $
Column00$ *
<00* +
string00+ 1
>001 2
(002 3
type003 7
:007 8
$str009 ?
,00? @
nullable00A I
:00I J
false00K P
)00P Q
,00Q R
UserId11 
=11 
table11 "
.11" #
Column11# )
<11) *
int11* -
>11- .
(11. /
type11/ 3
:113 4
$str115 >
,11> ?
nullable11@ H
:11H I
false11J O
)11O P
}22 
,22 
constraints33 
:33 
table33 "
=>33# %
{44 
table55 
.55 

PrimaryKey55 $
(55$ %
$str55% /
,55/ 0
x551 2
=>553 5
x556 7
.557 8
Id558 :
)55: ;
;55; <
table66 
.66 

ForeignKey66 $
(66$ %
name77 
:77 
$str77 5
,775 6
column88 
:88 
x88  !
=>88" $
x88% &
.88& '
UserId88' -
,88- .
principalTable99 &
:99& '
$str99( /
,99/ 0
principalColumn:: '
:::' (
$str::) -
,::- .
onDelete;;  
:;;  !
ReferentialAction;;" 3
.;;3 4
Cascade;;4 ;
);;; <
;;;< =
}<< 
)<< 
;<< 
migrationBuilder>> 
.>> 
CreateIndex>> (
(>>( )
name?? 
:?? 
$str?? '
,??' (
table@@ 
:@@ 
$str@@ 
,@@ 
columnAA 
:AA 
$strAA  
)AA  !
;AA! "
}BB 	
	protectedEE 
overrideEE 
voidEE 
DownEE  $
(EE$ %
MigrationBuilderEE% 5
migrationBuilderEE6 F
)EEF G
{FF 	
migrationBuilderGG 
.GG 
	DropTableGG &
(GG& '
nameHH 
:HH 
$strHH 
)HH 
;HH 
migrationBuilderJJ 
.JJ 
	DropTableJJ &
(JJ& '
nameKK 
:KK 
$strKK  
)KK  !
;KK! "
migrationBuilderMM 
.MM 
	DropTableMM &
(MM& '
nameNN 
:NN 
$strNN 
)NN 
;NN 
}OO 	
}PP 
}QQ È
g/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/Middleware/GlobalMiddleware.cs
public 
class 
GlobalMiddleware 
{ 
private 
readonly 
RequestDelegate $
_next% *
;* +
public 

GlobalMiddleware 
( 
RequestDelegate +
next, 0
)0 1
{		 
_next

 
=

 
next

 
;

 
} 
public 

async 
Task 
Invoke 
( 
HttpContext (
context) 0
)0 1
{ 
Console 
. 
	WriteLine 
( 
$" 
$str -
"- .
). /
;/ 0
await 
_next 
( 
context 
) 
; 
} 
} þ#
m/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/Middleware/ErrorHandlerMiddleware.cs
public 
class "
ErrorHandlerMiddleware #
{ 
private 
readonly 
RequestDelegate $
_next% *
;* +
public 
"
ErrorHandlerMiddleware !
(! "
RequestDelegate" 1
next2 6
)6 7
{ 
_next 
= 
next 
; 
} 
public 

async 
Task 
Invoke 
( 
HttpContext (
context) 0
)0 1
{		 
var

 
username

 
=

 
context

 
.

 
User

 #
.

# $
Identity

$ ,
?

, -
.

- .
Name

. 2
??

3 5
$str

6 A
;

A B
Console 
. 
	WriteLine 
( 
$" 
$str %
{% &
username& .
}. /
"/ 0
)0 1
;1 2
var 
ip 
= 
context 
. 

Connection #
.# $
RemoteIpAddress$ 3
.3 4
ToString4 <
(< =
)= >
;> ?
var 
headers 
= 
context 
. 
Request %
.% &
Headers& -
;- .
Console 
. 
	WriteLine 
( 
$" 
$str )
{) *
ip* ,
}, -
"- .
). /
;/ 0
Console 
. 
	WriteLine 
( 
$" 
$str *
{* +
context+ 2
.2 3
Request3 :
.: ;
Path; ?
}? @
"@ A
)A B
;B C
Console 
. 
	WriteLine 
( 
$" 
$str ,
{, -
context- 4
.4 5
Request5 <
.< =
Method= C
}C D
"D E
)E F
;F G
foreach 
( 
var 
header 
in 
headers &
)& '
{ 	
Console 
. 
	WriteLine 
( 
$"  
{  !
header! '
.' (
Key( +
}+ ,
$str, .
{. /
header/ 5
.5 6
Value6 ;
}; <
"< =
)= >
;> ?
} 	
try 
{ 	
await 
_next 
( 
context 
)  
;  !
} 	
catch 
( 
	Exception 
error 
) 
{ 	
var 
response 
= 
context "
." #
Response# +
;+ ,
response 
. 

StatusCode 
=  !
error" '
switch( .
{ '
UnauthorizedAccessException   +
=>  , .
StatusCodes  / :
.  : ;!
Status401Unauthorized  ; P
,  P Q 
KeyNotFoundException!! $
=>!!% '
StatusCodes!!( 3
.!!3 4
Status404NotFound!!4 E
,!!E F
ArgumentException"" !
=>""" $
StatusCodes""% 0
.""0 1
Status400BadRequest""1 D
,""D E
_## 
=>## 
StatusCodes##  
.##  !(
Status500InternalServerError##! =
}$$ 
;$$ 
response%% 
.%% 
ContentType%%  
=%%! "
$str%%# 5
;%%5 6
var&& 
result&& 
=&& 
System&& 
.&&  
Text&&  $
.&&$ %
Json&&% )
.&&) *
JsonSerializer&&* 8
.&&8 9
	Serialize&&9 B
(&&B C
new&&C F
{'' 
status(( 
=(( 
false(( 
,(( 
error)) 
=)) 
error)) 
.)) 
Message)) %
}** 
)** 
;** 
await++ 
response++ 
.++ 

WriteAsync++ %
(++% &
result++& ,
)++, -
;++- .
},, 	
}-- 
}.. ð	
e/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/Data/ApplicationDbContext.cs
	namespace 	
RestApi
 
. 
Data 
{ 
public 

class  
ApplicationDbContext %
:& '
	DbContext( 1
{ 
public  
ApplicationDbContext #
(# $
DbContextOptions$ 4
<4 5 
ApplicationDbContext5 I
>I J
optionsK R
)R S
:T U
baseV Z
(Z [
options[ b
)b c
{d e
}f g
public

 
DbSet

 
<

 
User

 
>

 
Users

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
DbSet 
< 
Note 
> 
Notes  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DbSet 
< 
Product 
> 
Products &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} 
} Ì
b/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/CustomValids/CityValid.cs
	namespace 	
RestApi
 
. 
CustomValids 
{ 
public 

class 
	CityValid 
: 
ValidationAttribute 0
{ 
	protected 
override 
ValidationResult +
IsValid, 3
(3 4
object4 :
?: ;
value< A
,A B
ValidationContextC T
validationContextU f
)f g
{ 	
string		 
[		 
]		 
validCities		  
=		! "
{		# $
$str		% /
,		/ 0
$str		1 9
,		9 :
$str		; B
}		C D
;		D E
if

 
(

 
validCities

 
.

 
Contains

 $
(

$ %
value

% *
?

* +
.

+ ,
ToString

, 4
(

4 5
)

5 6
!

6 7
.

7 8
ToLower

8 ?
(

? @
)

@ A
)

A B
)

B C
{ 
return 
ValidationResult '
.' (
Success( /
;/ 0
} 
else 
{ 
return 
new 
ValidationResult +
(+ ,
$str, h
)h i
;i j
} 
} 	
} 
} Š"
i/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/Controllers/ProductController.cs
	namespace 	
RestApi
 
. 
Controllers 
{ 
[		 
ApiController		 
]		 
[

 
Route

 

(


 
$str

 
)

 
]

 
[ 
	Authorize 
( 
Roles 
= 
$str  
)  !
]! "
public 

class 
ProductController "
:# $
ControllerBase% 3
{ 
private 
readonly  
ApplicationDbContext -
_context. 6
;6 7
public 
ProductController  
(  ! 
ApplicationDbContext! 5
context6 =
)= >
{ 	
_context 
= 
context 
; 
} 	
[ 	
HttpPost	 
] 
public 
IActionResult 
Create #
(# $
Product$ +
product, 3
)3 4
{ 	
_context 
. 
Products 
. 
Add !
(! "
product" )
)) *
;* +
_context 
. 
SaveChanges  
(  !
)! "
;" #
return 
Ok 
( 
product 
) 
; 
} 	
[ 	
HttpPut	 
( 
$str 
) 
] 
public 
IActionResult 
Update #
(# $
int$ '
id( *
,* +
Product, 3
product4 ;
); <
{ 	
var   
existingProduct   
=    !
_context  " *
.  * +
Products  + 3
.  3 4
Find  4 8
(  8 9
id  9 ;
)  ; <
;  < =
if!! 
(!! 
existingProduct!! 
==!!  "
null!!# '
)!!' (
{"" 
return## 
NotFound## 
(##  
)##  !
;##! "
}$$ 
existingProduct%% 
.%% 
Name%%  
=%%! "
product%%# *
.%%* +
Name%%+ /
;%%/ 0
existingProduct&& 
.&& 
Price&& !
=&&" #
product&&$ +
.&&+ ,
Price&&, 1
;&&1 2
_context'' 
.'' 
SaveChanges''  
(''  !
)''! "
;''" #
return(( 
Ok(( 
((( 
existingProduct(( %
)((% &
;((& '
})) 	
[++ 	

HttpDelete++	 
(++ 
$str++ 
)++ 
]++ 
public,, 
IActionResult,, 
Delete,, #
(,,# $
int,,$ '
id,,( *
),,* +
{-- 	
var.. 
product.. 
=.. 
_context.. "
..." #
Products..# +
...+ ,
Find.., 0
(..0 1
id..1 3
)..3 4
;..4 5
if// 
(// 
product// 
==// 
null// 
)//  
{00 
return11 
NotFound11 
(11  
)11  !
;11! "
}22 
_context33 
.33 
Products33 
.33 
Remove33 $
(33$ %
product33% ,
)33, -
;33- .
_context44 
.44 
SaveChanges44  
(44  !
)44! "
;44" #
return55 
Ok55 
(55 
)55 
;55 
}66 	
[88 	
HttpGet88	 
]88 
public99 
IActionResult99 
GetAll99 #
(99# $
)99$ %
{:: 	
var;; 
products;; 
=;; 
_context;; #
.;;# $
Products;;$ ,
.;;, -
ToList;;- 3
(;;3 4
);;4 5
;;;5 6
return<< 
Ok<< 
(<< 
products<< 
)<< 
;<<  
}== 	
}>> 
}?? ´ 
f/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/Controllers/NoteController.cs
	namespace 	
RestApi
 
. 
Controllers 
{		 
[

 
ApiController

 
]

 
[ 
Route 

(
 
$str 
) 
] 
[ 
	Authorize 
( 
Roles 
= 
$str 
) 
] 
public 

class 
NoteController 
:  !
ControllerBase" 0
{ 
private 
readonly  
ApplicationDbContext -
_context. 6
;6 7
public 
NoteController 
(  
ApplicationDbContext 2
context3 :
): ;
{ 	
_context 
= 
context 
; 
} 	
[ 	
HttpPost	 
] 
public 
IActionResult 
Create #
(# $
Note$ (
note) -
)- .
{ 	
_context 
. 
Notes 
. 
Add 
( 
note #
)# $
;$ %
_context 
. 
SaveChanges  
(  !
)! "
;" #
return 
Ok 
( 
note 
) 
; 
} 	
[ 	
HttpPut	 
( 
$str 
) 
] 
public 
IActionResult 
Update #
(# $
int$ '
id( *
,* +
Note, 0
note1 5
)5 6
{   	
var!! 
existingNote!! 
=!! 
_context!! '
.!!' (
Notes!!( -
.!!- .
Find!!. 2
(!!2 3
id!!3 5
)!!5 6
;!!6 7
if"" 
("" 
existingNote"" 
=="" 
null""  $
)""$ %
{## 
return$$ 
NotFound$$ 
($$  
)$$  !
;$$! "
}%% 
existingNote&& 
.&& 
Content&&  
=&&! "
note&&# '
.&&' (
Content&&( /
;&&/ 0
_context'' 
.'' 
SaveChanges''  
(''  !
)''! "
;''" #
return(( 
Ok(( 
((( 
existingNote(( "
)((" #
;((# $
})) 	
[++ 	

HttpDelete++	 
(++ 
$str++ 
)++ 
]++ 
public,, 
IActionResult,, 
Delete,, #
(,,# $
int,,$ '
id,,( *
),,* +
{-- 	
var.. 
note.. 
=.. 
_context.. 
...  
Notes..  %
...% &
Find..& *
(..* +
id..+ -
)..- .
;... /
if// 
(// 
note// 
==// 
null// 
)// 
{00 
return11 
NotFound11 
(11  
)11  !
;11! "
}22 
_context33 
.33 
Notes33 
.33 
Remove33 !
(33! "
note33" &
)33& '
;33' (
_context44 
.44 
SaveChanges44  
(44  !
)44! "
;44" #
return55 
Ok55 
(55 
)55 
;55 
}66 	
[88 	
HttpGet88	 
]88 
public99 
IActionResult99 
GetAll99 #
(99# $
)99$ %
{:: 	
var== 
notes== 
=== 
_context==  
.==  !
Notes==! &
.==& '
ToList==' -
(==- .
)==. /
;==/ 0
return>> 
Ok>> 
(>> 
notes>> 
)>> 
;>> 
}?? 	
}@@ 
}AA ÖM
f/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_1/RestApi/RestApi/Controllers/AuthController.cs
	namespace 	
RestApi
 
. 
Controllers 
{ 
[ 

EnableCors 
( 
$str )
)) *
]* +
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
AuthController 
:  !
ControllerBase" 0
{ 
string 
name 
= 
$str 
; 
private 
readonly  
ApplicationDbContext -
_context. 6
;6 7
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
public 
AuthController 
(  
ApplicationDbContext 2
context3 :
,: ;
IConfiguration< J
configurationK X
)X Y
{ 	
_configuration 
= 
configuration *
;* +
_context 
= 
context 
; 
} 	
[!! 	
HttpPost!!	 
(!! 
$str!! 
)!! 
]!! 
public"" 
IActionResult"" 
Register"" %
(""% &
User""& *
user""+ /
)""/ 0
{## 	
if$$ 
($$ 

ModelState$$ 
.$$ 
IsValid$$ "
==$$# %
false$$& +
)$$+ ,
{%% 
return&& 

BadRequest&& !
(&&! "

ModelState&&" ,
)&&, -
;&&- .
}'' 
user(( 
.(( 
Password(( 
=(( 
BCrypt(( "
.((" #
Net((# &
.((& '
BCrypt((' -
.((- .
HashPassword((. :
(((: ;
user((; ?
.((? @
Password((@ H
)((H I
;((I J
_context)) 
.)) 
Users)) 
.)) 
Add)) 
()) 
user)) #
)))# $
;))$ %
_context** 
.** 
SaveChanges**  
(**  !
)**! "
;**" #
return++ 
Ok++ 
(++ 
user++ 
)++ 
;++ 
},, 	
[.. 	
HttpPost..	 
(.. 
$str.. 
).. 
].. 
public// 
IActionResult// 
Login// "
(//" #
UserLoginDto//# /
userDto//0 7
)//7 8
{00 	
if11 
(11 

ModelState11 
.11 
IsValid11 "
==11# %
false11& +
)11+ ,
{22 
return33 

BadRequest33 !
(33! "

ModelState33" ,
)33, -
;33- .
}44 
var55 
user55 
=55 
new55 
User55 
{66 
Username77 
=77 
userDto77 "
.77" #
Username77# +
,77+ ,
Password88 
=88 
userDto88 "
.88" #
Password88# +
}99 
;99 
string;; 
passwordHash1;;  
=;;! "
BCrypt;;# )
.;;) *
Net;;* -
.;;- .
BCrypt;;. 4
.;;4 5
HashPassword;;5 A
(;;A B
user;;B F
.;;F G
Password;;G O
);;O P
;;;P Q
Console<< 
.<< 
	WriteLine<< 
(<< 
$str<< 1
+<<2 3
passwordHash1<<4 A
)<<A B
;<<B C
PasswordManager>> 
passwordManager>> +
=>>, -
new>>. 1
PasswordManager>>2 A
(>>A B
)>>B C
;>>C D
string?? 
newPass?? 
=?? 
passwordManager?? ,
.??, -
Encrypt??- 4
(??4 5
user??5 9
.??9 :
Password??: B
)??B C
;??C D
Console@@ 
.@@ 
	WriteLine@@ 
(@@ 
$str@@ 4
+@@5 6
newPass@@7 >
)@@> ?
;@@? @
stringBB 
decryptedPassBB  
=BB! "
passwordManagerBB# 2
.BB2 3
DecryptBB3 :
(BB: ;
newPassBB; B
)BBB C
;BBC D
ConsoleCC 
.CC 
	WriteLineCC 
(CC 
$strCC 4
+CC5 6
decryptedPassCC7 D
)CCD E
;CCE F
varEE 
existingUserEE 
=EE 
_contextEE '
.EE' (
UsersEE( -
.EE- .
FirstOrDefaultEE. <
(EE< =
uEE= >
=>EE? A
uEEB C
.EEC D
UsernameEED L
==EEM O
userEEP T
.EET U
UsernameEEU ]
)EE] ^
;EE^ _
ifFF 
(FF 
existingUserFF 
!=FF 
nullFF  $
)FF$ %
{GG 
ifII 
(II 
BCryptII 
.II 
NetII 
.II 
BCryptII %
.II% &
VerifyII& ,
(II, -
userII- 1
.II1 2
PasswordII2 :
,II: ;
existingUserII< H
.IIH I
PasswordIII Q
)IIQ R
)IIR S
{JJ 
ConsoleKK 
.KK 
	WriteLineKK %
(KK% &
$strKK& ;
)KK; <
;KK< =
}LL 
elseMM 
{NN 
returnOO 
UnauthorizedOO '
(OO' (
$strOO( :
)OO: ;
;OO; <
}PP 
}QQ 
elseRR 
{SS 
returnTT 
NotFoundTT 
(TT  
$strTT  0
)TT0 1
;TT1 2
}UU 
varXX 
tokenHandlerXX 
=XX 
newXX "#
JwtSecurityTokenHandlerXX# :
(XX: ;
)XX; <
;XX< =
varYY 
JwtKeyYY 
=YY 
_configurationYY '
.YY' (
GetValueYY( 0
<YY0 1
stringYY1 7
>YY7 8
(YY8 9
$strYY9 B
)YYB C
??YYD F
$strYYG I
;YYI J
varZZ 
keyZZ 
=ZZ 
EncodingZZ 
.ZZ 
ASCIIZZ $
.ZZ$ %
GetBytesZZ% -
(ZZ- .
JwtKeyZZ. 4
)ZZ4 5
;ZZ5 6
var\\ 
tokenDescriptor\\ 
=\\  !
new\\" %#
SecurityTokenDescriptor\\& =
{]] 
Subject^^ 
=^^ 
new^^ 
ClaimsIdentity^^ ,
(^^, -
new^^- 0
Claim^^1 6
[^^6 7
]^^7 8
{__ 
new`` 
Claim`` 
(`` 

ClaimTypes`` (
.``( )
Name``) -
,``- .
existingUser``/ ;
.``; <
Username``< D
)``D E
}aa 
)aa 
,aa 
Expiresbb 
=bb 
DateTimebb "
.bb" #
UtcNowbb# )
.bb) *
AddHoursbb* 2
(bb2 3
$numbb3 4
)bb4 5
,bb5 6
SigningCredentialscc "
=cc# $
newcc% (
SigningCredentialscc) ;
(cc; <
newcc< ? 
SymmetricSecurityKeycc@ T
(ccT U
keyccU X
)ccX Y
,ccY Z
SecurityAlgorithmscc[ m
.ccm n 
HmacSha256Signature	ccn 
)
cc ‚
}dd 
;dd 
ifee 
(ee 
tokenDescriptoree 
!=ee  "
nullee# '
)ee' (
{ff 
	ParseRolegg 
(gg 
existingUsergg &
.gg& '
Rolegg' +
,gg+ ,
tokenDescriptorgg- <
)gg< =
;gg= >
}hh 
varjj 
tokenjj 
=jj 
tokenHandlerjj $
.jj$ %
CreateTokenjj% 0
(jj0 1
tokenDescriptorjj1 @
)jj@ A
;jjA B
varkk 
tokenStringkk 
=kk 
tokenHandlerkk *
.kk* +

WriteTokenkk+ 5
(kk5 6
tokenkk6 ;
)kk; <
;kk< =
existingUserll 
.ll 
Passwordll !
=ll" #
nullll$ (
;ll( )
returnmm 
Okmm 
(mm 
newmm 
{mm 
Tokenmm !
=mm" #
tokenStringmm$ /
,mm/ 0
Usermm1 5
=mm6 7
existingUsermm8 D
}mmE F
)mmF G
;mmG H
}nn 	
privatepp 
voidpp 
	ParseRolepp 
(pp 
stringpp %
rolespp& +
,pp+ ,#
SecurityTokenDescriptorpp- D
tokenDescriptorppE T
)ppT U
{qq 	
varrr 
roleListrr 
=rr 
rolesrr  
.rr  !
Splitrr! &
(rr& '
$charrr' *
)rr* +
.rr+ ,
Selectrr, 2
(rr2 3
rrr3 4
=>rr5 7
rrr8 9
.rr9 :
Trimrr: >
(rr> ?
)rr? @
)rr@ A
.rrA B
ToListrrB H
(rrH I
)rrI J
;rrJ K
foreachss 
(ss 
varss 
roless 
inss  
roleListss! )
)ss) *
{tt 
tokenDescriptoruu 
.uu  
Subjectuu  '
.uu' (
AddClaimuu( 0
(uu0 1
newuu1 4
Claimuu5 :
(uu: ;

ClaimTypesuu; E
.uuE F
RoleuuF J
,uuJ K
roleuuL P
)uuP Q
)uuQ R
;uuR S
}vv 
}ww 	
}yy 
}zz 
Š
S/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/Startup.cs
public 
class 
Startup 
{ 
public		 

void		 
ConfigureServices		 !
(		! "
IServiceCollection		" 4
services		5 =
)		= >
{

 
var 
key 
= 
Encoding 
. 
ASCII  
.  !
GetBytes! )
() *
$str* j
)j k
;k l
services 
. 
AddAuthentication "
(" #
x# $
=>% '
{ 	
x 
. %
DefaultAuthenticateScheme '
=( )
JwtBearerDefaults* ;
.; < 
AuthenticationScheme< P
;P Q
x 
. "
DefaultChallengeScheme $
=% &
JwtBearerDefaults' 8
.8 9 
AuthenticationScheme9 M
;M N
} 	
)	 

. 	
AddJwtBearer	 
( 
x 
=> 
{ 	
x 
.  
RequireHttpsMetadata "
=# $
false% *
;* +
x 
. 
	SaveToken 
= 
true 
; 
x 
. %
TokenValidationParameters '
=( )
new* -%
TokenValidationParameters. G
{ $
ValidateIssuerSigningKey (
=) *
true+ /
,/ 0
IssuerSigningKey  
=! "
new# & 
SymmetricSecurityKey' ;
(; <
key< ?
)? @
,@ A
ValidateIssuer 
=  
false! &
,& '
ValidateAudience  
=! "
false# (
} 
; 
} 	
)	 

;
 
services 
. 
AddMvc 
( 
) 
; 
} 
public   

void   
	Configure   
(   
IApplicationBuilder   -
app  . 1
,  1 2
IWebHostEnvironment  3 F
env  G J
)  J K
{!! 
if"" 

("" 
env"" 
."" 
IsDevelopment"" 
("" 
)"" 
)""  
{## 	
app$$ 
.$$ %
UseDeveloperExceptionPage$$ )
($$) *
)$$* +
;$$+ ,
}%% 	
else&& 
{'' 	
app(( 
.(( 
UseHsts(( 
((( 
)(( 
;(( 
})) 	
app++ 
.++ 
UseHttpsRedirection++ 
(++  
)++  !
;++! "
app,, 
.,, 
UseAuthentication,, 
(,, 
),, 
;,,  
app-- 
.-- 
UseMvc-- 
(-- 
)-- 
;-- 
}.. 
}// ñ@
d/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/Services/PasswordManager.cs
public 
class 
PasswordManager 
{ 
private 
readonly 
byte 
[ 
] 
_key  
;  !
private		 
readonly		 
byte		 
[		 
]		 
_iv		 
;		  
string

 


_secretKey

 
=

 
$str

 F
;

F G
public 

PasswordManager 
( 
) 
{ 
using 
( 
var 
deriveBytes 
=  
new! $
Rfc2898DeriveBytes% 7
(7 8

_secretKey 
, 
new 
byte 
[ 
] 
{ 
$num 
, 
$num #
,# $
$num% )
,) *
$num+ /
,/ 0
$num1 5
,5 6
$num7 ;
,; <
$num= A
,A B
$numC G
}H I
,I J
$num 
, 
HashAlgorithmName 
. 
SHA256 $
) 	
)	 

{ 	
_key 
= 
deriveBytes 
. 
GetBytes '
(' (
$num( *
)* +
;+ ,
_iv 
= 
deriveBytes 
. 
GetBytes &
(& '
$num' )
)) *
;* +
} 	
} 
public 

string 
Encrypt 
( 
string  
	plainText! *
)* +
{ 
if 

( 
string 
. 
IsNullOrEmpty  
(  !
	plainText! *
)* +
)+ ,
throw 
new !
ArgumentNullException +
(+ ,
nameof, 2
(2 3
	plainText3 <
)< =
)= >
;> ?
byte   
[   
]   
encryptedBytes   
;   
using"" 
("" 
var"" 
aesAlg"" 
="" 
Aes"" 
.""  
Create""  &
(""& '
)""' (
)""( )
{## 	
aesAlg$$ 
.$$ 
Key$$ 
=$$ 
_key$$ 
;$$ 
aesAlg'' 
.'' 

GenerateIV'' 
('' 
)'' 
;''  
byte(( 
[(( 
](( 
iv(( 
=(( 
aesAlg(( 
.(( 
IV(( !
;((! "
ICryptoTransform** 
	encryptor** &
=**' (
aesAlg**) /
.**/ 0
CreateEncryptor**0 ?
(**? @
aesAlg**@ F
.**F G
Key**G J
,**J K
iv**L N
)**N O
;**O P
using,, 
(,, 
var,, 
	msEncrypt,,  
=,,! "
new,,# &
MemoryStream,,' 3
(,,3 4
),,4 5
),,5 6
{-- 
	msEncrypt// 
.// 
Write// 
(//  
iv//  "
,//" #
$num//$ %
,//% &
iv//' )
.//) *
Length//* 0
)//0 1
;//1 2
using11 
(11 
var11 
	csEncrypt11 $
=11% &
new11' *
CryptoStream11+ 7
(117 8
	msEncrypt118 A
,11A B
	encryptor11C L
,11L M
CryptoStreamMode11N ^
.11^ _
Write11_ d
)11d e
)11e f
using22 
(22 
var22 
	swEncrypt22 $
=22% &
new22' *
StreamWriter22+ 7
(227 8
	csEncrypt228 A
)22A B
)22B C
{33 
	swEncrypt44 
.44 
Write44 #
(44# $
	plainText44$ -
)44- .
;44. /
}55 
encryptedBytes77 
=77  
	msEncrypt77! *
.77* +
ToArray77+ 2
(772 3
)773 4
;774 5
}88 
}99 	
return;; 
Convert;; 
.;; 
ToBase64String;; %
(;;% &
encryptedBytes;;& 4
);;4 5
;;;5 6
}<< 
public>> 

string>> 
Decrypt>> 
(>> 
string>>  

cipherText>>! +
)>>+ ,
{?? 
if@@ 

(@@ 
string@@ 
.@@ 
IsNullOrEmpty@@  
(@@  !

cipherText@@! +
)@@+ ,
)@@, -
throwAA 
newAA !
ArgumentNullExceptionAA +
(AA+ ,
nameofAA, 2
(AA2 3

cipherTextAA3 =
)AA= >
)AA> ?
;AA? @
byteCC 
[CC 
]CC 
cipherBytesCC 
=CC 
ConvertCC $
.CC$ %
FromBase64StringCC% 5
(CC5 6

cipherTextCC6 @
)CC@ A
;CCA B
usingEE 
(EE 
varEE 
aesAlgEE 
=EE 
AesEE 
.EE  
CreateEE  &
(EE& '
)EE' (
)EE( )
{FF 	
aesAlgGG 
.GG 
KeyGG 
=GG 
_keyGG 
;GG 
byteJJ 
[JJ 
]JJ 
ivJJ 
=JJ 
newJJ 
byteJJ  
[JJ  !
$numJJ! #
]JJ# $
;JJ$ %
ArrayKK 
.KK 
CopyKK 
(KK 
cipherBytesKK "
,KK" #
$numKK$ %
,KK% &
ivKK' )
,KK) *
$numKK+ ,
,KK, -
ivKK. 0
.KK0 1
LengthKK1 7
)KK7 8
;KK8 9
aesAlgLL 
.LL 
IVLL 
=LL 
ivLL 
;LL 
ICryptoTransformNN 
	decryptorNN &
=NN' (
aesAlgNN) /
.NN/ 0
CreateDecryptorNN0 ?
(NN? @
aesAlgNN@ F
.NNF G
KeyNNG J
,NNJ K
aesAlgNNL R
.NNR S
IVNNS U
)NNU V
;NNV W
usingPP 
(PP 
varPP 
	msDecryptPP  
=PP! "
newPP# &
MemoryStreamPP' 3
(PP3 4
cipherBytesPP4 ?
,PP? @
$numPPA C
,PPC D
cipherBytesPPE P
.PPP Q
LengthPPQ W
-PPX Y
$numPPZ \
)PP\ ]
)PP] ^
usingQQ 
(QQ 
varQQ 
	csDecryptQQ  
=QQ! "
newQQ# &
CryptoStreamQQ' 3
(QQ3 4
	msDecryptQQ4 =
,QQ= >
	decryptorQQ? H
,QQH I
CryptoStreamModeQQJ Z
.QQZ [
ReadQQ[ _
)QQ_ `
)QQ` a
usingRR 
(RR 
varRR 
	srDecryptRR  
=RR! "
newRR# &
StreamReaderRR' 3
(RR3 4
	csDecryptRR4 =
)RR= >
)RR> ?
{SS 
returnTT 
	srDecryptTT  
.TT  !
	ReadToEndTT! *
(TT* +
)TT+ ,
;TT, -
}UU 
}VV 	
}WW 
public[[ 

string[[ 
GenerateSecureKey[[ #
([[# $
int[[$ '
keySizeInBytes[[( 6
=[[7 8
$num[[9 ;
)[[; <
{\\ 
byte]] 
[]] 
]]] 
key]] 
=]] 
new]] 
byte]] 
[]] 
keySizeInBytes]] ,
]]], -
;]]- .
using^^ 
(^^ 
var^^ 
rng^^ 
=^^ !
RandomNumberGenerator^^ .
.^^. /
Create^^/ 5
(^^5 6
)^^6 7
)^^7 8
{__ 	
rng`` 
.`` 
GetBytes`` 
(`` 
key`` 
)`` 
;`` 
}aa 	
returnbb 
Convertbb 
.bb 
ToBase64Stringbb %
(bb% &
keybb& )
)bb) *
;bb* +
}cc 
}dd ø5
S/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. 
AddRateLimiter 
(  
options  '
=>( *
{ 
options 
. 
GlobalLimiter 
= "
PartitionedRateLimiter 2
.2 3
Create3 9
<9 :
HttpContext: E
,E F
stringG M
>M N
(N O
httpContextO Z
=>[ ]
RateLimitPartition 
. !
GetFixedWindowLimiter 0
(0 1
partitionKey 
: 
httpContext %
.% &
User& *
.* +
Identity+ 3
?3 4
.4 5
Name5 9
??: <
httpContext= H
.H I
RequestI P
.P Q
HeadersQ X
.X Y
HostY ]
.] ^
ToString^ f
(f g
)g h
,h i
factory 
: 
	partition 
=> !
new" %)
FixedWindowRateLimiterOptions& C
{ 
AutoReplenishment !
=" #
true$ (
,( )
PermitLimit 
= 
$num 
,  

QueueLimit 
= 
$num 
, 
Window 
= 
TimeSpan !
.! "
FromSeconds" -
(- .
$num. 0
)0 1
} 
) 
) 
; 
} 
) 
; 
builder 
. 
Services 
. 
AddDbContext 
<  
ApplicationDbContext 2
>2 3
(3 4
options4 ;
=>< >
options 
. 
	UseSqlite 
( 
builder 
. 
Configuration +
.+ ,
GetConnectionString, ?
(? @
$str@ S
)S T
)T U
)U V
;V W
builder 
. 
Services 
. 
AddControllers 
(  
)  !
;! "
var "
MyAllowSpecificOrigins 
= 
$str 7
;7 8
builder   
.   
Services   
.   
AddCors   
(   
options    
=>  ! #
{!! 
options"" 
."" 
	AddPolicy"" 
("" 
name"" 
:"" "
MyAllowSpecificOrigins"" 2
,""2 3
policy## 

=>## 
{$$ 
policy%% 
.%% 
WithOrigins%% 
(%% 
$str&&  
)'' 	
.(( 	
AllowAnyHeader((	 
((( 
)(( 
.)) 	
AllowAnyMethod))	 
()) 
))) 
.** 	
AllowCredentials**	 
(** 
)** 
;** 
}++ 
)++ 
;++ 
},, 
),, 
;,, 
var00 
key00 
=00 	
Encoding00
 
.00 
ASCII00 
.00 
GetBytes00 !
(00! "
builder00" )
.00) *
Configuration00* 7
.007 8
GetValue008 @
<00@ A
string00A G
>00G H
(00H I
$str00I R
)00R S
)00S T
;00T U
builder11 
.11 
Services11 
.11 
AddAuthentication11 "
(11" #
JwtBearerDefaults11# 4
.114 5 
AuthenticationScheme115 I
)11I J
.22 
AddJwtBearer22 
(22 
options22 
=>22 
{33 
options44 
.44  
RequireHttpsMetadata44 $
=44% &
false44' ,
;44, -
options55 
.55 
	SaveToken55 
=55 
true55  
;55  !
options66 
.66 %
TokenValidationParameters66 )
=66* +
new66, /%
TokenValidationParameters660 I
{77 	$
ValidateIssuerSigningKey88 $
=88% &
true88' +
,88+ ,
IssuerSigningKey99 
=99 
new99 " 
SymmetricSecurityKey99# 7
(997 8
key998 ;
)99; <
,99< =
ValidateIssuer:: 
=:: 
false:: "
,::" #
ValidateAudience;; 
=;; 
false;; $
}<< 	
;<<	 

}== 
)== 
;== 
var?? 
app?? 
=?? 	
builder??
 
.?? 
Build?? 
(?? 
)?? 
;?? 
ifBB 
(BB 
!BB 
appBB 
.BB 	
EnvironmentBB	 
.BB 
IsDevelopmentBB "
(BB" #
)BB# $
)BB$ %
{CC 
appDD 
.DD 
UseHstsDD 
(DD 
)DD 
;DD 
appEE 
.EE 
UseHttpsRedirectionEE 
(EE 
)EE 
;EE 
}GG 
appKK 
.KK 
UseCorsKK 
(KK "
MyAllowSpecificOriginsKK "
)KK" #
;KK# $
ifNN 
(NN 
appNN 
.NN 
EnvironmentNN 
.NN 
IsDevelopmentNN !
(NN! "
)NN" #
)NN# $
{OO 
appPP 
.PP %
UseDeveloperExceptionPagePP !
(PP! "
)PP" #
;PP# $
}QQ 
appSS 
.SS 
UseMiddlewareSS 
<SS "
ErrorHandlerMiddlewareSS (
>SS( )
(SS) *
)SS* +
;SS+ ,
appTT 
.TT 
UseMiddlewareTT 
<TT 
GlobalMiddlewareTT "
>TT" #
(TT# $
)TT$ %
;TT% &
appUU 
.UU 
UseRateLimiterUU 
(UU 
)UU 
;UU 
appVV 
.VV 
UseHttpsRedirectionVV 
(VV 
)VV 
;VV 
appWW 
.WW 
UseAuthenticationWW 
(WW 
)WW 
;WW 
appXX 
.XX 
UseAuthorizationXX 
(XX 
)XX 
;XX 
appZZ 
.ZZ 
MapControllersZZ 
(ZZ 
)ZZ 
;ZZ 
app\\ 
.\\ 
Run\\ 
(\\ 
)\\ 	
;\\	 
¥	
W/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/Models/User.cs
	namespace 	
RestApi
 
. 
Models 
{ 
public 

class 
User 
{ 
[ 	
Key	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public

 
string

 
Username

 
{

  
get

! $
;

$ %
set

& )
;

) *
}

+ ,
=

- .
string

/ 5
.

5 6
Empty

6 ;
;

; <
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Role 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} 
} Í
Z/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/Models/Product.cs
	namespace 	
RestApi
 
. 
Models 
{ 
public 

class 
Product 
{ 
[ 	
Key	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[

 	
Required

	 
]

 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
[ 	
Required	 
] 
public 
decimal 
Price 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} ‚

W/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/Models/Note.cs
	namespace 	
RestApi
 
. 
Models 
{ 
public 

class 
Note 
{ 
[ 	
Key	 
] 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
[ 	
Required	 
] 
public 
string 
Content 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
[ 	
Required	 
] 
public 
int 
UserId 
{ 
get 
;  
set! $
;$ %
}& '
[ 	

ForeignKey	 
( 
$str 
) 
] 
public 
User 
User 
{ 
get 
; 
set  #
;# $
}% &
=' (
null) -
!- .
;. /
} 
} ×
c/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/Models/dto/UserLoginDto.cs
	namespace 	
RestApi
 
. 
Models 
. 
Dto 
{ 
public 

class 
UserLoginDto 
{ 
[

 	
Required

	 
]

 
[ 	
StringLength	 
( 
maximumLength #
:# $
$num% (
,( )
MinimumLength* 7
=8 9
$num: ;
,; <
ErrorMessage= I
=J K
$strL {
){ |
]| }
[ 	
EmailAddress	 
( 
ErrorMessage "
=# $
$str% H
)H I
]I J
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
[ 	
Required	 
] 
[ 	
StringLength	 
( 
maximumLength #
:# $
$num% '
,' (
MinimumLength) 6
=7 8
$num9 :
,: ;
ErrorMessage< H
=I J
$strK y
)y z
]z {
[ 	
RegularExpression	 
( 
$str ,
,, -
ErrorMessage. :
=; <
$str= \
)\ ]
]] ^
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
[ 	
Required	 
] 
[ 	
	CityValid	 
( 
ErrorMessage 
=  !
$str" ^
)^ _
]_ `
public 
string 
City 
{ 
get  
;  !
set" %
;% &
}' (
=) *
string+ 1
.1 2
Empty2 7
;7 8
} 
} Ñ9
s/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/Migrations/20250311115221_InitialCreate.cs
	namespace 	
RestApi
 
. 

Migrations 
{ 
public 

partial 
class 
InitialCreate &
:' (
	Migration) 2
{		 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str  
,  !
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 :
,: ;
nullable< D
:D E
falseF K
)K L
. 

Annotation #
(# $
$str$ :
,: ;
true< @
)@ A
,A B
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
type0 4
:4 5
$str6 <
,< =
nullable> F
:F G
falseH M
)M N
,N O
Price 
= 
table !
.! "
Column" (
<( )
decimal) 0
>0 1
(1 2
type2 6
:6 7
$str8 >
,> ?
nullable@ H
:H I
falseJ O
)O P
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 2
,2 3
x4 5
=>6 8
x9 :
.: ;
Id; =
)= >
;> ?
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
, 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 :
,: ;
nullable< D
:D E
falseF K
)K L
.   

Annotation   #
(  # $
$str  $ :
,  : ;
true  < @
)  @ A
,  A B
Username!! 
=!! 
table!! $
.!!$ %
Column!!% +
<!!+ ,
string!!, 2
>!!2 3
(!!3 4
type!!4 8
:!!8 9
$str!!: @
,!!@ A
nullable!!B J
:!!J K
false!!L Q
)!!Q R
,!!R S
Password"" 
="" 
table"" $
.""$ %
Column""% +
<""+ ,
string"", 2
>""2 3
(""3 4
type""4 8
:""8 9
$str"": @
,""@ A
nullable""B J
:""J K
false""L Q
)""Q R
,""R S
Role## 
=## 
table##  
.##  !
Column##! '
<##' (
string##( .
>##. /
(##/ 0
type##0 4
:##4 5
$str##6 <
,##< =
nullable##> F
:##F G
false##H M
)##M N
}$$ 
,$$ 
constraints%% 
:%% 
table%% "
=>%%# %
{&& 
table'' 
.'' 

PrimaryKey'' $
(''$ %
$str''% /
,''/ 0
x''1 2
=>''3 5
x''6 7
.''7 8
Id''8 :
)'': ;
;''; <
}(( 
)(( 
;(( 
migrationBuilder** 
.** 
CreateTable** (
(**( )
name++ 
:++ 
$str++ 
,++ 
columns,, 
:,, 
table,, 
=>,, !
new,," %
{-- 
Id.. 
=.. 
table.. 
... 
Column.. %
<..% &
int..& )
>..) *
(..* +
type..+ /
:../ 0
$str..1 :
,..: ;
nullable..< D
:..D E
false..F K
)..K L
.// 

Annotation// #
(//# $
$str//$ :
,//: ;
true//< @
)//@ A
,//A B
Content00 
=00 
table00 #
.00# $
Column00$ *
<00* +
string00+ 1
>001 2
(002 3
type003 7
:007 8
$str009 ?
,00? @
nullable00A I
:00I J
false00K P
)00P Q
,00Q R
UserId11 
=11 
table11 "
.11" #
Column11# )
<11) *
int11* -
>11- .
(11. /
type11/ 3
:113 4
$str115 >
,11> ?
nullable11@ H
:11H I
false11J O
)11O P
}22 
,22 
constraints33 
:33 
table33 "
=>33# %
{44 
table55 
.55 

PrimaryKey55 $
(55$ %
$str55% /
,55/ 0
x551 2
=>553 5
x556 7
.557 8
Id558 :
)55: ;
;55; <
table66 
.66 

ForeignKey66 $
(66$ %
name77 
:77 
$str77 5
,775 6
column88 
:88 
x88  !
=>88" $
x88% &
.88& '
UserId88' -
,88- .
principalTable99 &
:99& '
$str99( /
,99/ 0
principalColumn:: '
:::' (
$str::) -
,::- .
onDelete;;  
:;;  !
ReferentialAction;;" 3
.;;3 4
Cascade;;4 ;
);;; <
;;;< =
}<< 
)<< 
;<< 
migrationBuilder>> 
.>> 
CreateIndex>> (
(>>( )
name?? 
:?? 
$str?? '
,??' (
table@@ 
:@@ 
$str@@ 
,@@ 
columnAA 
:AA 
$strAA  
)AA  !
;AA! "
}BB 	
	protectedEE 
overrideEE 
voidEE 
DownEE  $
(EE$ %
MigrationBuilderEE% 5
migrationBuilderEE6 F
)EEF G
{FF 	
migrationBuilderGG 
.GG 
	DropTableGG &
(GG& '
nameHH 
:HH 
$strHH 
)HH 
;HH 
migrationBuilderJJ 
.JJ 
	DropTableJJ &
(JJ& '
nameKK 
:KK 
$strKK  
)KK  !
;KK! "
migrationBuilderMM 
.MM 
	DropTableMM &
(MM& '
nameNN 
:NN 
$strNN 
)NN 
;NN 
}OO 	
}PP 
}QQ È
g/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/Middleware/GlobalMiddleware.cs
public 
class 
GlobalMiddleware 
{ 
private 
readonly 
RequestDelegate $
_next% *
;* +
public 

GlobalMiddleware 
( 
RequestDelegate +
next, 0
)0 1
{		 
_next

 
=

 
next

 
;

 
} 
public 

async 
Task 
Invoke 
( 
HttpContext (
context) 0
)0 1
{ 
Console 
. 
	WriteLine 
( 
$" 
$str -
"- .
). /
;/ 0
await 
_next 
( 
context 
) 
; 
} 
} ð	
e/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/Data/ApplicationDbContext.cs
	namespace 	
RestApi
 
. 
Data 
{ 
public 

class  
ApplicationDbContext %
:& '
	DbContext( 1
{ 
public  
ApplicationDbContext #
(# $
DbContextOptions$ 4
<4 5 
ApplicationDbContext5 I
>I J
optionsK R
)R S
:T U
baseV Z
(Z [
options[ b
)b c
{d e
}f g
public

 
DbSet

 
<

 
User

 
>

 
Users

  
{

! "
get

# &
;

& '
set

( +
;

+ ,
}

- .
public 
DbSet 
< 
Note 
> 
Notes  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DbSet 
< 
Product 
> 
Products &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} 
} þ#
m/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/Middleware/ErrorHandlerMiddleware.cs
public 
class "
ErrorHandlerMiddleware #
{ 
private 
readonly 
RequestDelegate $
_next% *
;* +
public 
"
ErrorHandlerMiddleware !
(! "
RequestDelegate" 1
next2 6
)6 7
{ 
_next 
= 
next 
; 
} 
public 

async 
Task 
Invoke 
( 
HttpContext (
context) 0
)0 1
{		 
var

 
username

 
=

 
context

 
.

 
User

 #
.

# $
Identity

$ ,
?

, -
.

- .
Name

. 2
??

3 5
$str

6 A
;

A B
Console 
. 
	WriteLine 
( 
$" 
$str %
{% &
username& .
}. /
"/ 0
)0 1
;1 2
var 
ip 
= 
context 
. 

Connection #
.# $
RemoteIpAddress$ 3
.3 4
ToString4 <
(< =
)= >
;> ?
var 
headers 
= 
context 
. 
Request %
.% &
Headers& -
;- .
Console 
. 
	WriteLine 
( 
$" 
$str )
{) *
ip* ,
}, -
"- .
). /
;/ 0
Console 
. 
	WriteLine 
( 
$" 
$str *
{* +
context+ 2
.2 3
Request3 :
.: ;
Path; ?
}? @
"@ A
)A B
;B C
Console 
. 
	WriteLine 
( 
$" 
$str ,
{, -
context- 4
.4 5
Request5 <
.< =
Method= C
}C D
"D E
)E F
;F G
foreach 
( 
var 
header 
in 
headers &
)& '
{ 	
Console 
. 
	WriteLine 
( 
$"  
{  !
header! '
.' (
Key( +
}+ ,
$str, .
{. /
header/ 5
.5 6
Value6 ;
}; <
"< =
)= >
;> ?
} 	
try 
{ 	
await 
_next 
( 
context 
)  
;  !
} 	
catch 
( 
	Exception 
error 
) 
{ 	
var 
response 
= 
context "
." #
Response# +
;+ ,
response 
. 

StatusCode 
=  !
error" '
switch( .
{ '
UnauthorizedAccessException   +
=>  , .
StatusCodes  / :
.  : ;!
Status401Unauthorized  ; P
,  P Q 
KeyNotFoundException!! $
=>!!% '
StatusCodes!!( 3
.!!3 4
Status404NotFound!!4 E
,!!E F
ArgumentException"" !
=>""" $
StatusCodes""% 0
.""0 1
Status400BadRequest""1 D
,""D E
_## 
=>## 
StatusCodes##  
.##  !(
Status500InternalServerError##! =
}$$ 
;$$ 
response%% 
.%% 
ContentType%%  
=%%! "
$str%%# 5
;%%5 6
var&& 
result&& 
=&& 
System&& 
.&&  
Text&&  $
.&&$ %
Json&&% )
.&&) *
JsonSerializer&&* 8
.&&8 9
	Serialize&&9 B
(&&B C
new&&C F
{'' 
status(( 
=(( 
false(( 
,(( 
error)) 
=)) 
error)) 
.)) 
Message)) %
}** 
)** 
;** 
await++ 
response++ 
.++ 

WriteAsync++ %
(++% &
result++& ,
)++, -
;++- .
},, 	
}-- 
}.. Ì
b/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/CustomValids/CityValid.cs
	namespace 	
RestApi
 
. 
CustomValids 
{ 
public 

class 
	CityValid 
: 
ValidationAttribute 0
{ 
	protected 
override 
ValidationResult +
IsValid, 3
(3 4
object4 :
?: ;
value< A
,A B
ValidationContextC T
validationContextU f
)f g
{ 	
string		 
[		 
]		 
validCities		  
=		! "
{		# $
$str		% /
,		/ 0
$str		1 9
,		9 :
$str		; B
}		C D
;		D E
if

 
(

 
validCities

 
.

 
Contains

 $
(

$ %
value

% *
?

* +
.

+ ,
ToString

, 4
(

4 5
)

5 6
!

6 7
.

7 8
ToLower

8 ?
(

? @
)

@ A
)

A B
)

B C
{ 
return 
ValidationResult '
.' (
Success( /
;/ 0
} 
else 
{ 
return 
new 
ValidationResult +
(+ ,
$str, h
)h i
;i j
} 
} 	
} 
} Š"
i/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/Controllers/ProductController.cs
	namespace 	
RestApi
 
. 
Controllers 
{ 
[		 
ApiController		 
]		 
[

 
Route

 

(


 
$str

 
)

 
]

 
[ 
	Authorize 
( 
Roles 
= 
$str  
)  !
]! "
public 

class 
ProductController "
:# $
ControllerBase% 3
{ 
private 
readonly  
ApplicationDbContext -
_context. 6
;6 7
public 
ProductController  
(  ! 
ApplicationDbContext! 5
context6 =
)= >
{ 	
_context 
= 
context 
; 
} 	
[ 	
HttpPost	 
] 
public 
IActionResult 
Create #
(# $
Product$ +
product, 3
)3 4
{ 	
_context 
. 
Products 
. 
Add !
(! "
product" )
)) *
;* +
_context 
. 
SaveChanges  
(  !
)! "
;" #
return 
Ok 
( 
product 
) 
; 
} 	
[ 	
HttpPut	 
( 
$str 
) 
] 
public 
IActionResult 
Update #
(# $
int$ '
id( *
,* +
Product, 3
product4 ;
); <
{ 	
var   
existingProduct   
=    !
_context  " *
.  * +
Products  + 3
.  3 4
Find  4 8
(  8 9
id  9 ;
)  ; <
;  < =
if!! 
(!! 
existingProduct!! 
==!!  "
null!!# '
)!!' (
{"" 
return## 
NotFound## 
(##  
)##  !
;##! "
}$$ 
existingProduct%% 
.%% 
Name%%  
=%%! "
product%%# *
.%%* +
Name%%+ /
;%%/ 0
existingProduct&& 
.&& 
Price&& !
=&&" #
product&&$ +
.&&+ ,
Price&&, 1
;&&1 2
_context'' 
.'' 
SaveChanges''  
(''  !
)''! "
;''" #
return(( 
Ok(( 
((( 
existingProduct(( %
)((% &
;((& '
})) 	
[++ 	

HttpDelete++	 
(++ 
$str++ 
)++ 
]++ 
public,, 
IActionResult,, 
Delete,, #
(,,# $
int,,$ '
id,,( *
),,* +
{-- 	
var.. 
product.. 
=.. 
_context.. "
..." #
Products..# +
...+ ,
Find.., 0
(..0 1
id..1 3
)..3 4
;..4 5
if// 
(// 
product// 
==// 
null// 
)//  
{00 
return11 
NotFound11 
(11  
)11  !
;11! "
}22 
_context33 
.33 
Products33 
.33 
Remove33 $
(33$ %
product33% ,
)33, -
;33- .
_context44 
.44 
SaveChanges44  
(44  !
)44! "
;44" #
return55 
Ok55 
(55 
)55 
;55 
}66 	
[88 	
HttpGet88	 
]88 
public99 
IActionResult99 
GetAll99 #
(99# $
)99$ %
{:: 	
var;; 
products;; 
=;; 
_context;; #
.;;# $
Products;;$ ,
.;;, -
ToList;;- 3
(;;3 4
);;4 5
;;;5 6
return<< 
Ok<< 
(<< 
products<< 
)<< 
;<<  
}== 	
}>> 
}?? ´ 
f/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/Controllers/NoteController.cs
	namespace		 	
RestApi		
 
.		 
Controllers		 
{

 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
[ 
	Authorize 
( 
Roles 
= 
$str 
) 
] 
public 

class 
NoteController 
:  !
ControllerBase" 0
{ 
private 
readonly  
ApplicationDbContext -
_context. 6
;6 7
public 
NoteController 
(  
ApplicationDbContext 2
context3 :
): ;
{ 	
_context 
= 
context 
; 
} 	
[ 	
HttpPost	 
] 
public 
IActionResult 
Create #
(# $
Note$ (
note) -
)- .
{ 	
_context 
. 
Notes 
. 
Add 
( 
note #
)# $
;$ %
_context 
. 
SaveChanges  
(  !
)! "
;" #
return 
Ok 
( 
note 
) 
; 
} 	
[ 	
HttpPut	 
( 
$str 
) 
] 
public   
IActionResult   
Update   #
(  # $
int  $ '
id  ( *
,  * +
Note  , 0
note  1 5
)  5 6
{!! 	
var"" 
existingNote"" 
="" 
_context"" '
.""' (
Notes""( -
.""- .
Find"". 2
(""2 3
id""3 5
)""5 6
;""6 7
if## 
(## 
existingNote## 
==## 
null##  $
)##$ %
{$$ 
return%% 
NotFound%% 
(%%  
)%%  !
;%%! "
}&& 
existingNote'' 
.'' 
Content''  
=''! "
note''# '
.''' (
Content''( /
;''/ 0
_context(( 
.(( 
SaveChanges((  
(((  !
)((! "
;((" #
return)) 
Ok)) 
()) 
existingNote)) "
)))" #
;))# $
}** 	
[,, 	

HttpDelete,,	 
(,, 
$str,, 
),, 
],, 
public-- 
IActionResult-- 
Delete-- #
(--# $
int--$ '
id--( *
)--* +
{.. 	
var// 
note// 
=// 
_context// 
.//  
Notes//  %
.//% &
Find//& *
(//* +
id//+ -
)//- .
;//. /
if00 
(00 
note00 
==00 
null00 
)00 
{11 
return22 
NotFound22 
(22  
)22  !
;22! "
}33 
_context44 
.44 
Notes44 
.44 
Remove44 !
(44! "
note44" &
)44& '
;44' (
_context55 
.55 
SaveChanges55  
(55  !
)55! "
;55" #
return66 
Ok66 
(66 
)66 
;66 
}77 	
[99 	
HttpGet99	 
]99 
public:: 
IActionResult:: 
GetAll:: #
(::# $
)::$ %
{;; 	
var>> 
notes>> 
=>> 
_context>>  
.>>  !
Notes>>! &
.>>& '
ToList>>' -
(>>- .
)>>. /
;>>/ 0
return?? 
Ok?? 
(?? 
notes?? 
)?? 
;?? 
}@@ 	
}AA 
}BB  Z
f/Users/hakan/Documents/GitHub/ak_sigorta_2025_securtiy_2/RestApi/RestApi/Controllers/AuthController.cs
	namespace 	
RestApi
 
. 
Controllers 
{ 
[ 

EnableCors 
( 
$str )
)) *
]* +
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
AuthController 
:  !
ControllerBase" 0
{ 
string 
name 
= 
$str 
; 
private 
readonly  
ApplicationDbContext -
_context. 6
;6 7
private 
readonly 
IConfiguration '
_configuration( 6
;6 7
public 
AuthController 
(  
ApplicationDbContext 2
context3 :
,: ;
IConfiguration< J
configurationK X
)X Y
{ 	
_configuration 
= 
configuration *
;* +
_context 
= 
context 
; 
} 	
["" 	
HttpPost""	 
("" 
$str"" 
)"" 
]"" 
public## 
IActionResult## 
Register## %
(##% &
User##& *
user##+ /
)##/ 0
{$$ 	
if%% 
(%% 

ModelState%% 
.%% 
IsValid%% "
==%%# %
false%%& +
)%%+ ,
{&& 
return'' 

BadRequest'' !
(''! "

ModelState''" ,
)'', -
;''- .
}(( 
user)) 
.)) 
Password)) 
=)) 
BCrypt)) "
.))" #
Net))# &
.))& '
BCrypt))' -
.))- .
HashPassword)). :
()): ;
user)); ?
.))? @
Password))@ H
)))H I
;))I J
_context** 
.** 
Users** 
.** 
Add** 
(** 
user** #
)**# $
;**$ %
_context++ 
.++ 
SaveChanges++  
(++  !
)++! "
;++" #
return,, 
Ok,, 
(,, 
user,, 
),, 
;,, 
}-- 	
[// 	
HttpPost//	 
(// 
$str// 
)// 
]// 
public00 
IActionResult00 
	LoginUser00 &
(00& '
UserLoginDto00' 3
userDto004 ;
)00; <
{11 	
string22 
query22 
=22 
$str22 X
;22X Y
Console33 
.33 
	WriteLine33 
(33 
$str33 '
+33( )
query33* /
)33/ 0
;330 1
var44 
userDb44 
=44 
_context44 !
.44! "
Users44" '
.44' (

FromSqlRaw44( 2
(442 3
query443 8
,448 9
userDto44: A
.44A B
Username44B J
,44J K
userDto44L S
.44S T
Password44T \
)44\ ]
.44] ^
FirstOrDefault44^ l
(44l m
)44m n
;44n o
if55 
(55 
userDb55 
==55 
null55 
)55 
{66 
return77 
Unauthorized77 #
(77# $
$str77$ B
)77B C
;77C D
}88 
return99 
Ok99 
(99 
userDb99 
)99 
;99 
}:: 	
[<< 	
HttpPost<<	 
(<< 
$str<< 
)<< 
]<< 
public== 
IActionResult== 
Login== "
(==" #
UserLoginDto==# /
userDto==0 7
)==7 8
{>> 	
int?? 
a?? 
=?? 
$num?? 
;?? 
int@@ 
i@@ 
=@@ 
a@@ 
/@@ 
$num@@ 
;@@ 
ifAA 
(AA 

ModelStateAA 
.AA 
IsValidAA "
==AA# %
falseAA& +
)AA+ ,
{BB 
returnCC 

BadRequestCC !
(CC! "

ModelStateCC" ,
)CC, -
;CC- .
}DD 
varEE 
userEE 
=EE 
newEE 
UserEE 
{FF 
UsernameGG 
=GG 
userDtoGG "
.GG" #
UsernameGG# +
,GG+ ,
PasswordHH 
=HH 
userDtoHH "
.HH" #
PasswordHH# +
}II 
;II 
stringKK 
passwordHash1KK  
=KK! "
BCryptKK# )
.KK) *
NetKK* -
.KK- .
BCryptKK. 4
.KK4 5
HashPasswordKK5 A
(KKA B
userKKB F
.KKF G
PasswordKKG O
)KKO P
;KKP Q
ConsoleLL 
.LL 
	WriteLineLL 
(LL 
$strLL 1
+LL2 3
passwordHash1LL4 A
)LLA B
;LLB C
PasswordManagerNN 
passwordManagerNN +
=NN, -
newNN. 1
PasswordManagerNN2 A
(NNA B
)NNB C
;NNC D
stringOO 
newPassOO 
=OO 
passwordManagerOO ,
.OO, -
EncryptOO- 4
(OO4 5
userOO5 9
.OO9 :
PasswordOO: B
)OOB C
;OOC D
ConsolePP 
.PP 
	WriteLinePP 
(PP 
$strPP 4
+PP5 6
newPassPP7 >
)PP> ?
;PP? @
stringRR 
decryptedPassRR  
=RR! "
passwordManagerRR# 2
.RR2 3
DecryptRR3 :
(RR: ;
newPassRR; B
)RRB C
;RRC D
ConsoleSS 
.SS 
	WriteLineSS 
(SS 
$strSS 4
+SS5 6
decryptedPassSS7 D
)SSD E
;SSE F
varUU 
existingUserUU 
=UU 
_contextUU '
.UU' (
UsersUU( -
.UU- .
FirstOrDefaultUU. <
(UU< =
uUU= >
=>UU? A
uUUB C
.UUC D
UsernameUUD L
==UUM O
userUUP T
.UUT U
UsernameUUU ]
)UU] ^
;UU^ _
ifVV 
(VV 
existingUserVV 
!=VV 
nullVV  $
)VV$ %
{WW 
ifYY 
(YY 
BCryptYY 
.YY 
NetYY 
.YY 
BCryptYY %
.YY% &
VerifyYY& ,
(YY, -
userYY- 1
.YY1 2
PasswordYY2 :
,YY: ;
existingUserYY< H
.YYH I
PasswordYYI Q
)YYQ R
)YYR S
{ZZ 
Console[[ 
.[[ 
	WriteLine[[ %
([[% &
$str[[& ;
)[[; <
;[[< =
}\\ 
else]] 
{^^ 
return__ 
Unauthorized__ '
(__' (
$str__( :
)__: ;
;__; <
}`` 
}aa 
elsebb 
{cc 
returndd 
NotFounddd 
(dd  
$strdd  0
)dd0 1
;dd1 2
}ee 
varhh 
tokenHandlerhh 
=hh 
newhh "#
JwtSecurityTokenHandlerhh# :
(hh: ;
)hh; <
;hh< =
varii 
JwtKeyii 
=ii 
_configurationii '
.ii' (
GetValueii( 0
<ii0 1
stringii1 7
>ii7 8
(ii8 9
$strii9 B
)iiB C
??iiD F
$striiG I
;iiI J
varjj 
keyjj 
=jj 
Encodingjj 
.jj 
ASCIIjj $
.jj$ %
GetBytesjj% -
(jj- .
JwtKeyjj. 4
)jj4 5
;jj5 6
varll 
tokenDescriptorll 
=ll  !
newll" %#
SecurityTokenDescriptorll& =
{mm 
Subjectnn 
=nn 
newnn 
ClaimsIdentitynn ,
(nn, -
newnn- 0
Claimnn1 6
[nn6 7
]nn7 8
{oo 
newpp 
Claimpp 
(pp 

ClaimTypespp (
.pp( )
Namepp) -
,pp- .
existingUserpp/ ;
.pp; <
Usernamepp< D
)ppD E
}qq 
)qq 
,qq 
Expiresrr 
=rr 
DateTimerr "
.rr" #
UtcNowrr# )
.rr) *
AddHoursrr* 2
(rr2 3
$numrr3 4
)rr4 5
,rr5 6
SigningCredentialsss "
=ss# $
newss% (
SigningCredentialsss) ;
(ss; <
newss< ? 
SymmetricSecurityKeyss@ T
(ssT U
keyssU X
)ssX Y
,ssY Z
SecurityAlgorithmsss[ m
.ssm n 
HmacSha256Signature	ssn 
)
ss ‚
}tt 
;tt 
ifuu 
(uu 
tokenDescriptoruu 
!=uu  "
nulluu# '
)uu' (
{vv 
	ParseRoleww 
(ww 
existingUserww &
.ww& '
Roleww' +
,ww+ ,
tokenDescriptorww- <
)ww< =
;ww= >
}xx 
varzz 
tokenzz 
=zz 
tokenHandlerzz $
.zz$ %
CreateTokenzz% 0
(zz0 1
tokenDescriptorzz1 @
)zz@ A
;zzA B
var{{ 
tokenString{{ 
={{ 
tokenHandler{{ *
.{{* +

WriteToken{{+ 5
({{5 6
token{{6 ;
){{; <
;{{< =
existingUser|| 
.|| 
Password|| !
=||" #
null||$ (
;||( )
return}} 
Ok}} 
(}} 
new}} 
{}} 
Token}} !
=}}" #
tokenString}}$ /
,}}/ 0
User}}1 5
=}}6 7
existingUser}}8 D
}}}E F
)}}F G
;}}G H
}~~ 	
private
€€ 
void
€€ 
	ParseRole
€€ 
(
€€ 
string
€€ %
roles
€€& +
,
€€+ ,%
SecurityTokenDescriptor
€€- D
tokenDescriptor
€€E T
)
€€T U
{
 	
var
‚‚ 
roleList
‚‚ 
=
‚‚ 
roles
‚‚  
.
‚‚  !
Split
‚‚! &
(
‚‚& '
$char
‚‚' *
)
‚‚* +
.
‚‚+ ,
Select
‚‚, 2
(
‚‚2 3
r
‚‚3 4
=>
‚‚5 7
r
‚‚8 9
.
‚‚9 :
Trim
‚‚: >
(
‚‚> ?
)
‚‚? @
)
‚‚@ A
.
‚‚A B
ToList
‚‚B H
(
‚‚H I
)
‚‚I J
;
‚‚J K
foreach
ƒƒ 
(
ƒƒ 
var
ƒƒ 
role
ƒƒ 
in
ƒƒ  
roleList
ƒƒ! )
)
ƒƒ) *
{
„„ 
tokenDescriptor
…… 
.
……  
Subject
……  '
.
……' (
AddClaim
……( 0
(
……0 1
new
……1 4
Claim
……5 :
(
……: ;

ClaimTypes
……; E
.
……E F
Role
……F J
,
……J K
role
……L P
)
……P Q
)
……Q R
;
……R S
}
†† 
}
‡‡ 	
}
‰‰ 
}ŠŠ 